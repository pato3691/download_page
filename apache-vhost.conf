<VirtualHost *:80>
    ServerName your_domain.com
    ServerAlias www.your_domain.com
    DocumentRoot /var/www/html

    # Proxy settings for Next.js application
    ProxyPreserveHost On
    ProxyPass /down/ http://localhost:3000/
    ProxyPassReverse /down/ http://localhost:3000/

    # Headers for proxying
    <Location /down/>
        ProxyPassReverse /
        Header set X-Real-IP %{REMOTE_ADDR}s
        Header set X-Forwarded-For %{HTTP:X-Forwarded-For}e
        Header set X-Forwarded-Proto "http"
    </Location>

    # Enable compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Cache settings
    <LocationMatch "^/down/_next/static/">
        Header set Cache-Control "public, max-age=2592000"
    </LocationMatch>

    <LocationMatch "^/down/uploads/">
        Header set Cache-Control "public, max-age=604800"
    </LocationMatch>

    # Error and Access logs
    ErrorLog ${APACHE_LOG_DIR}/download_page_error.log
    CustomLog ${APACHE_LOG_DIR}/download_page_access.log combined
</VirtualHost>
